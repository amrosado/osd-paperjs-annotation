<head>
    <title>Text Tool Demo</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.0.0/openseadragon.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.17/paper-full.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="./demo.css">

    <script type="module">
        import { AnnotationToolbar } from '../src/js/annotationtoolbar.mjs';
        import{ AnnotationToolkit } from '../src/js/annotationtoolkit.mjs';
        // Basic viewer setup
        let viewer = OpenSeadragon({
            element: 'brush-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: 'https://openseadragon.github.io/example-images/grand-canyon-landscape-overlooking.jpg',
                buildPyramid: false
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        viewer.addHandler('open', () => {
            let paperScope = new paper.PaperScope(); // Create a new PaperScope
            paperScope.setup('brush-canvas'); // Set up Paper.js with the specified canvas ID

            // Create the AnnotationToolkit instance with annotationUI selecting a tool and add feature collections
            let annotationToolkit = new AnnotationToolkit(viewer);
            annotationToolkit.addAnnotationUI({tools:["text" , "style"], addButton:false, addFileButton:false});

            $.get('./demo-annotation.json').then(x => annotationToolkit.addFeatureCollections(x));
        });
        
        let exampleviewer = OpenSeadragon({
            element: 'example-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: './tissue.jpg',
                buildPyramid: true
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        exampleviewer.addHandler('open', () => {
            let exPaperScope = new paper.PaperScope(); // Create a new PaperScope
            exPaperScope.setup('example-canvas'); // Set up Paper.js with the specified canvas ID
        
            // Create the AnnotationToolkit instance for the example viewer
            let exAnnotationToolkit = new AnnotationToolkit(exampleviewer);
            exAnnotationToolkit.addAnnotationUI({tools:["text" , "style"], addButton:false, addFileButton:false});
        
            $.get('./tissue-annotation.json').then(x => exAnnotationToolkit.addFeatureCollections(x));
        });
    </script>
</head>
<body>
    <div class="content">
        <div class="demo">
            <h3>Text Tool Demo</h3>
            <div id="brush-viewer" class="viewer"></div>
            <div>
                <h4>How to Use the Text Toolbox Tool:</h4>
                <p>
                    The Text Toolbox Tool allows you to create point-based text annotations on the map. Follow these steps to use it effectively:
                </p>
                <ol>
                    <li><strong>Creating a Point Text:</strong> To create a point-based text annotation, first add a feature using the annotation tool kit, then use the text tool from the  toolbar to click on the desired location on the map.</li>
                    <li><strong>Editing the Text:</strong> Once the point text is created, you can edit its content by clicking on the enter text and modifying it under the text icon on the toolbar. you can also edit the location of the textbox by clicking the text on the viewer and moving it </li>
                    <li><strong>Customizing the Style:</strong> The text's style can be customized. You can change the font size, stroke width, fill color, etc by using the style tool from the toolkit, please look at the style demo for a more indepth exaplanation. </li>
                    <li><strong>Saving Changes:</strong> Any changes made to the text annotations are automatically saved.</li>
                </ol>
            
                <div>
                    <h4>Note:</h4>
                    <p>
                        Text annotations created using the Text Toolbox Tool are point-based and may lose scalability when scaled. Ensure that you create annotations at appropriate sizes to maintain clarity in your map.
                    </p>
                </div>
                <div class="guided-usage">
                    <h3>Guided Usage: Using the Text Toolbox Tool with Annotations</h3>
                    <p>
                        As you examine the brain tissue image with existing annotations, consider how the Text Toolbox Tool can help you provide additional information and context:
                    </p>
                    <ol>
                        <li><strong>Task:</strong> Enhance the annotations by adding descriptive text to certain regions of interest.</li>
                        <li><strong>Use Case:</strong> Identify specific structures within the tissue that need clarification for further analysis.</li>
                        <li><strong>Solution:</strong> Follow these steps:
                            <ul>
                                <li>Select add feature to add an annotation on the viewer that represents a the textbox location near a structure or feature.</li>
                                <li>Activate the Text Toolbox Tool from the toolbar.</li>
                                <li>Click on the annotation or a nearby location to create a point-based text annotation.</li>
                                <li>Edit the content of the text annotation to provide relevant information about the selected structure.</li>
                                <li>Customize the style of the text annotation, such as font size and fill color, using the Style Tool for better visibility.</li>
                                <li>Save your changes.</li>
                            </ul>
                        </li>
                        <li><strong>Example:</strong> Select an annotation representing a "Blood Vessel" structure. Use the Text Toolbox Tool to create a text annotation that describes the size or function of the blood vessel. Customize the text style to ensure it stands out from the image.</li>
                    </ol>
                    <div id="example-viewer" class="viewer"></div>
                </div>

    <!-- The canvas used for Paper.js -->
    
    <canvas id="example-canvas" style="display:none;"></canvas>
    <canvas id="brush-canvas" style="display:none;"></canvas>
</body>
</html>
