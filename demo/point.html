<head>
    <title>Point Tool Demo</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.0.0/openseadragon.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.17/paper-full.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="./demo.css">

    <script type="module">
        import { AnnotationToolbar } from '../src/js/annotationtoolbar.mjs';
        import{ AnnotationToolkit } from '../src/js/annotationtoolkit.mjs';
        // Basic viewer setup
        let viewer = OpenSeadragon({
            element: 'brush-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: 'https://openseadragon.github.io/example-images/grand-canyon-landscape-overlooking.jpg',
                buildPyramid: false
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        viewer.addHandler('open', () => {
            let paperScope = new paper.PaperScope(); // Create a new PaperScope
            paperScope.setup('brush-canvas'); // Set up Paper.js with the specified canvas ID

            // Create the AnnotationToolkit instance with annotationUI selecting a tool and add feature collections
            let annotationToolkit = new AnnotationToolkit(viewer);
            annotationToolkit.addAnnotationUI({tools:["point"], addButton:false, addFileButton:false});

            $.get('./demo-annotation.json').then(x => annotationToolkit.addFeatureCollections(x));
        });
        
        let exampleviewer = OpenSeadragon({
            element: 'example-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: './tissue.jpg',
                buildPyramid: true
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        exampleviewer.addHandler('open', () => {
            let exPaperScope = new paper.PaperScope(); // Create a new PaperScope
            exPaperScope.setup('example-canvas'); // Set up Paper.js with the specified canvas ID
        
            // Create the AnnotationToolkit instance for the example viewer
            let exAnnotationToolkit = new AnnotationToolkit(exampleviewer);
            exAnnotationToolkit.addAnnotationUI({tools:["point"], addButton:false, addFileButton:false});
        
            $.get('./tissue-annotation.json').then(x => exAnnotationToolkit.addFeatureCollections(x));
        });
    </script>
</head>
<body>
    <div class="content">
        <div class="demo">
            <h3>Point Tool Demo</h3>
            <div id="brush-viewer" class="viewer"></div>
            <div>
                <h4>How to Use the Point Tool:</h4>
                <p>
                    The Point Tool allows you to add and reposition points on the map. Follow these steps to use it effectively:
                </p>
                <ol>
                    <li><strong>Adding a New Point:</strong> To add a new point, select the "Point Tool" icon from the toolbar (map pin icon). Click anywhere on the map to place the point. You can add multiple points by repeating this step.</li>
                    <li><strong>Repositioning an Existing Point:</strong> If you want to move a point to a different location, hover over the point you wish to move. It will be highlighted. Click and drag the point to its new location, then release the mouse button to drop the point at the new position.</li>
                </ol>
                <p>
                    The Point Tool makes it easy to mark specific locations, points of interest, or landmarks on your map.
                </p>
            </div>
            <div>
            </div>
            <div>
                <h4>Note:</h4>
                <p>
                    The Point Tool is designed to work with other annotation items created using supported tools. It allows you to interact with these annotations and efficiently manage them on the map.
                </p>
            </div>
            <div class="guided-usage">
                <h4>Guided Usage: Annotating Brain Tissue Regions with the Point Tool</h4>
                <p>
                    Explore how the Point Tool aids in annotating brain tissue regions for detailed analysis and documentation:
                </p>
                <ol>
                    <li><strong>Task:</strong> Use the Point Tool to mark regions of interest within brain tissue images.</li>
                    <li><strong>Use Case:</strong> You're analyzing microscopic brain tissue images and need to identify locations of specific cellular structures and abnormalities.</li>
                    <li><strong>Solution:</strong> Employ the Point Tool effectively for accurate annotations:
                        <ul>
                            <li>Select the "Point Tool" icon in the toolbar (map pin icon).</li>
                            <li>Click on significant points within the brain tissue to mark areas of interest, such as cell clusters or anomalies.</li>
                            <li>For precision, reposition points by clicking and dragging them to desired positions.</li>
                        </ul>
                    </li>
                    <li><strong>Example:</strong> We want to examine the locations of where blood vessels can appear on a brain tissue. We already have annotations of blood vessels, but since we dont want to consider their size or shape lets replace those polygon annotations with point annotations! This aids in recording locations for further research and analysis on where specfic cells might appear.</li>
                </ol>
                <div id="example-viewer" class="viewer"></div>
            </div>
        </div>

    <!-- The canvas used for Paper.js -->
    <canvas id="example-canvas" style="display:none;"></canvas>
    <canvas id="brush-canvas" style="display:none;"></canvas></body>
</html>
