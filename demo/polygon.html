<head>
    <title>Polygon Tool Demo</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.0.0/openseadragon.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.17/paper-full.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="./demo.css">

    <script type="module">
        import { AnnotationToolbar } from '../src/js/annotationtoolbar.mjs';
        import{ AnnotationToolkit } from '../src/js/annotationtoolkit.mjs';
        // Basic viewer setup
        let viewer = OpenSeadragon({
            element: 'brush-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: 'https://openseadragon.github.io/example-images/grand-canyon-landscape-overlooking.jpg',
                buildPyramid: false
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        viewer.addHandler('open', () => {
            let paperScope = new paper.PaperScope(); // Create a new PaperScope
            paperScope.setup('brush-canvas'); // Set up Paper.js with the specified canvas ID

            // Create the AnnotationToolkit instance with annotationUI selecting a tool and add feature collections
            let annotationToolkit = new AnnotationToolkit(viewer);
            annotationToolkit.addAnnotationUI({tools:["polygon"], addButton:false, addFileButton:false});

            $.get('./demo-annotation.json').then(x => annotationToolkit.addFeatureCollections(x));
        });
        
        let exampleviewer = OpenSeadragon({
            element: 'example-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: './tissue.jpg',
                buildPyramid: true
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        exampleviewer.addHandler('open', () => {
            let exPaperScope = new paper.PaperScope(); // Create a new PaperScope
            exPaperScope.setup('example-canvas'); // Set up Paper.js with the specified canvas ID
        
            // Create the AnnotationToolkit instance for the example viewer
            let exAnnotationToolkit = new AnnotationToolkit(exampleviewer);
            exAnnotationToolkit.addAnnotationUI({tools:["polygon"], addButton:false, addFileButton:false});
        
            $.get('./tissue-annotation.json').then(x => exAnnotationToolkit.addFeatureCollections(x));
        });
    </script>
</head>
<body>
    <div class="content">
        <div class="demo">
            <h3>Polygon Tool Demo</h3>
            <div id="brush-viewer" class="viewer"></div>
            <div>
                    <h4>How to Use the Polygon Tool:</h4>
                    <p>
                        The Polygon Tool allows you to draw and edit polygons on the map. Follow these steps to use it effectively:
                    </p>
                    <ol>
                        <li><strong>Adding a New Polygon:</strong> To start drawing a new polygon, first add a new feature, select the "Polygon Tool" icon from the toolbar (polygon icon). Click anywhere on the map to add the first point of the polygon. Then, click or drag to add additional points to the polygon. To complete the polygon, click on the first point again, or simply double-click anywhere on the map.</li>
                        <li><strong>Editing a Polygon:</strong> To edit an existing polygon, click and drag any of its points to move them to a new location. To remove a point and reshape the polygon, click on the point and press the 'Delete' key.</li>
                        <li><strong>Erasing:</strong> To erase parts of a polygon, enable the "Eraser" mode by clicking the "Eraser" button in the toolbar. Then, click on a segment of the polygon to remove it.</li>
                        <li><strong>Simplifying:</strong> To simplify the polygon and reduce the number of points, click the "Simplify" button in the toolbar. This will remove redundant points while maintaining the overall shape of the polygon.</li>
                        <li><strong>Undo and Redo:</strong> To undo or redo your actions, use the keyboard shortcuts 'Ctrl + Z' and 'Ctrl + Shift + Z', respectively.</li>
                    </ol>
                    <p>
                        The Polygon Tool makes it easy to draw and modify complex shapes on the map.
                    </p>
                </div>
                <div>
                    <h4>Keyboard Shortcuts:</h4>
                    <ul>
                        <li><strong>Click:</strong> Click to add new points to the polygon.</li>
                        <li><strong>Double-click:</strong> Double-click to finish drawing the polygon.</li>
                        <li><strong>Click and Drag:</strong> Click and drag to add or move points.</li>
                        <li><strong>Delete:</strong> Press the 'Delete' key to remove a selected point.</li>
                        <li><strong>Ctrl + Z:</strong> Undo your last action.</li>
                        <li><strong>Ctrl + Shift + Z:</strong> Redo your last undone action.</li>
                    </ul>
                </div>
                <div>
                </div>
                <div class="guided-usage">
                    <h3>Guided Usage: Utilizing the Polygon Tool for Annotations</h3>
                    <p>
                        Discover the potential of the Polygon Tool for creating and editing polygons to highlight intricate features on the map:
                    </p>
                    <ol>
                        <li><strong>Task:</strong> Utilize the Polygon Tool to accurately draw and modify polygons on the map.</li>
                        <li><strong>Use Case:</strong> You've identified complex regions within the brain tissue image that you want to highlight for further analysis. The Polygon Tool enables you to create precise polygons to outline these areas.</li>
                        <li><strong>Solution:</strong> Follow these steps to effectively use the Polygon Tool:
                        </li>
                        <li><strong>Example:</strong> You've observed a blood vessel within the grey matter (black area highlighted) of the brain tissue. Utilize the Polygon Tool to create polygons around these blood vessels, allowing you to create new annotation for them.</li>
                    </ol>
                    <div id="example-viewer" class="viewer"></div>
                </div>
            </div>

    <!-- The canvas used for Paper.js -->
    <canvas id="example-canvas" style="display:none;"></canvas>
    <canvas id="brush-canvas" style="display:none;"></canvas></body>
</html>
