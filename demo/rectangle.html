<head>
    <title>Rectangle Tool Demo</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.0.0/openseadragon.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.17/paper-full.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="./demo.css">

    <script type="module">
        import { AnnotationToolbar } from '../src/js/annotationtoolbar.mjs';
        import{ AnnotationToolkit } from '../src/js/annotationtoolkit.mjs';
        // Basic viewer setup
        let viewer = OpenSeadragon({
            element: 'brush-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: 'https://openseadragon.github.io/example-images/grand-canyon-landscape-overlooking.jpg',
                buildPyramid: false
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        viewer.addHandler('open', () => {
            let paperScope = new paper.PaperScope(); // Create a new PaperScope
            paperScope.setup('brush-canvas'); // Set up Paper.js with the specified canvas ID

            // Create the AnnotationToolkit instance with annotationUI selecting a tool and add feature collections
            let annotationToolkit = new AnnotationToolkit(viewer);
            annotationToolkit.addAnnotationUI({tools:["rectangle"], addButton:false, addFileButton:false});

            $.get('./demo-annotation.json').then(x => annotationToolkit.addFeatureCollections(x));
        });
        
        let exampleviewer = OpenSeadragon({
            element: 'example-viewer',
            prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
            tileSources: {
                type: 'image',
                url: './tissue.jpg',
                buildPyramid: true
            },
            minZoomImageRatio: 0.01,
            visibilityRatio: 0,
            crossOriginPolicy: 'Anonymous',
            ajaxWithCredentials: false
        });

        exampleviewer.addHandler('open', () => {
            let exPaperScope = new paper.PaperScope(); // Create a new PaperScope
            exPaperScope.setup('example-canvas'); // Set up Paper.js with the specified canvas ID
        
            // Create the AnnotationToolkit instance for the example viewer
            let exAnnotationToolkit = new AnnotationToolkit(exampleviewer);
            exAnnotationToolkit.addAnnotationUI({tools:["rectangle"], addButton:false, addFileButton:false});
        
            $.get('./tissue-annotation.json').then(x => exAnnotationToolkit.addFeatureCollections(x));
        });
    </script>
</head>
<body>
    <div class="content">
        <div class="demo">
            <h3>Rectangle Tool Demo</h3>
            <div id="brush-viewer" class="viewer"></div>
            <div>
                <h4>How to use:</h4>
                <p>The Rectangle Tool in the Annotation Toolkit allows users to create and modify rectangles on the canvas.
                    It provides options to draw new rectangles, resize existing rectangles, and move them around.</p>
                <ol>
                    <li><strong>Activate the Rectangle Tool:</strong> Select the Rectangle Tool from the list of available
                        tools in the Annotation Toolkit.</li>
                    <li><strong>Create a New Rectangle:</strong>
                        <ul>
                            <li>Click on the canvas to set the starting point of the rectangle.</li>
                            <li>While holding down the mouse button, drag the mouse to define the dimensions of the
                                rectangle.</li>
                            <li>Release the mouse button to create the rectangle.</li>
                        </ul>
                    </li>
                    <li><strong>Modify Existing Rectangles:</strong>
                        <ul>
                            <li>To resize an existing rectangle, hover the mouse over one of its corners until it changes
                                appearance.</li>
                            <li>Click and drag the corner to resize the rectangle.</li>
                            <li>You can also resize the rectangle proportionally by holding down the Command (or Control)
                                key while dragging.</li>
                            <li>To move an existing rectangle, click and drag it to the desired location on the canvas.</li>
                        </ul>
                    </li>
                    <li><strong>Finish Modifying:</strong> Once you are done creating or modifying the rectangle,
                        release the mouse button.</li>
             </div>
        </div>
        <div class="guided-usage">
            <h3>Guided Usage: Using the Rectangle Tool for Annotations</h3>
            <p>
                Explore the Rectangle Tool to create and manipulate rectangles for precise annotation placement:
            </p>
            <ol>
                <li><strong>Task:</strong> Enhance your annotation strategy by adding rectangular annotations to highlight specific regions.</li>
                <li><strong>Use Case:</strong> Identify and emphasize particular areas of interest within the brain tissue.</li>
                <li><strong>Example:</strong> Identify a complex structure, like a "Blood Vessel," in the brain tissue image.
                    Use the Rectangle Tool to create a rectangle around the vessel, ensuring it stands out for further analysis.</li>
            </ol>
            <div id="example-viewer" class="viewer"></div>
        </div>
    </div>

    <!-- The canvas used for Paper.js -->
    <canvas id="example-canvas" style="display:none;"></canvas>
    <canvas id="brush-canvas" style="display:none;"></canvas>
</body>
</html>
